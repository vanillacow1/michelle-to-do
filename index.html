<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180x180.png" />
    <meta name="theme-color" content="#5b21b6" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Michelle's To-Do ListðŸ’–</title>

    <style>
      :root {
        --soft-purple: #f284d7;
        --lighter-purple: #f2cff0;
        --dark-purple: #e066d6;
        --gray: #555;
        --error-red: #d9534f;
      }
      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--lighter-purple);
        display: flex;
        flex-direction: column;
        height: 100vh;
        padding: 1rem;
        color: var(--dark-purple);
      }
      h1 {
        text-align: center;
        margin-bottom: 0.5rem;
        font-weight: 700;
      }
      form {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
      }
      input[type="text"] {
        flex-grow: 1;
        padding: 0.6rem 0.8rem;
        font-size: 1.1rem;
        border: 2px solid var(--soft-purple);
        border-radius: 8px;
        outline: none;
        transition: border-color 0.3s ease;
        min-width: 150px;
      }
      input[type="text"]:focus {
        border-color: var(--dark-purple);
      }
      select {
        padding: 0.6rem;
        font-size: 1.1rem;
        border-radius: 8px;
        border: 2px solid var(--soft-purple);
        background: white;
        color: var(--dark-purple);
        cursor: pointer;
      }
      select:focus {
        border-color: var(--dark-purple);
        outline: none;
      }
      button {
        background: var(--soft-purple);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0 1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        min-width: 70px;
      }
      button:hover {
        background: var(--dark-purple);
      }
      section {
        flex-grow: 1;
        overflow-y: auto;
        margin-bottom: 1rem;
        padding: 0.5rem;
        border-radius: 12px;
        box-shadow: 0 3px 8px rgb(90 62 142 / 0.15);
        background: var(--lighter-purple);
        border: 2px solid var(--soft-purple);
        display: flex;
        flex-direction: column;
        position: relative;
      }
      h2 {
        margin-top: 0;
        margin-bottom: 0.5rem;
        font-weight: 700;
      }
      ul {
        list-style: none;
        padding-left: 0;
        margin: 0;
        flex-grow: 1;
      }
      li {
        background: white;
        margin-bottom: 0.5rem;
        border-radius: 8px;
        display: flex;
        align-items: center;
        padding: 0.5rem 1rem;
        box-shadow: 0 2px 6px rgb(90 62 142 / 0.15);
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      li.completed label {
        text-decoration: line-through;
        color: var(--gray);
      }
      #daily-list li.completed label {
        color: #6b46c1;
      }
      input[type="checkbox"] {
        width: 20px;
        height: 20px;
        margin-right: 1rem;
        cursor: pointer;
      }
      label {
        flex-grow: 1;
        font-size: 1.1rem;
        user-select: none;
      }
      .delete-btn {
        background: transparent;
        border: none;
        color: var(--soft-purple);
        font-weight: 700;
        cursor: pointer;
        font-size: 1.2rem;
        padding: 0 0.3rem;
        transition: color 0.3s ease;
      }
      .delete-btn:hover {
        color: var(--dark-purple);
      }
      .drag-handle {
        cursor: grab;
        font-size: 1.3rem;
        padding: 0 0.5rem;
        color: var(--soft-purple);
        user-select: none;
        transition: color 0.3s ease;
        margin-left: 0.3rem;
      }
      .drag-handle:active {
        cursor: grabbing;
        color: var(--dark-purple);
      }
      #clear-today-btn {
        margin-top: 0.5rem;
        align-self: center;
        width: 100%;
        max-width: 200px;
        position: relative;
        z-index: 1;
      }
      #error-message {
        margin-top: 0.25rem;
        color: var(--error-red);
        font-weight: 600;
        text-align: center;
        display: none;
      }
      #confetti-container {
        pointer-events: none;
        position: fixed;
        bottom: 110px;
        left: 50%;
        transform: translateX(-50%);
        width: 200px;
        height: 150px;
        overflow: visible;
        z-index: 9999;
        display: none;
      }
      .confetti {
        position: absolute;
        width: 10px;
        height: 6px;
        background-color: var(--soft-purple);
        opacity: 0.9;
        border-radius: 2px;
        animation-fill-mode: forwards;
        animation-timing-function: ease-out;
      }
      @keyframes confetti-burst {
        0% {
          transform: translate(0, 0) rotate(0deg);
          opacity: 1;
        }
        80% {
          opacity: 1;
        }
        100% {
          transform: translate(var(--x-move), var(--y-move)) rotate(720deg);
          opacity: 0;
        }
      }
      #encouragement-message {
        text-align: center;
        font-weight: 700;
        color: var(--dark-purple);
        margin-top: 0.5rem;
        display: none;
        font-size: 1.2rem;
      }
      body.dark-mode {
        --soft-purple: #6b46c1;
        --lighter-purple: #2d2a42;
        --dark-purple: #c6b9ff;
        --gray: #bbb;
        --error-red: #f25c54;
        background: var(--lighter-purple);
        color: var(--dark-purple);
      }
      body.dark-mode input[type="text"],
      body.dark-mode select {
        border-color: var(--soft-purple);
        background: #3b3756;
        color: var(--dark-purple);
      }
      body.dark-mode li {
        background: #3b3756;
        box-shadow: 0 2px 6px rgba(183, 145, 255, 0.3);
      }
      body.dark-mode li.completed label {
        color: var(--gray);
      }
      body.dark-mode button {
        background: var(--soft-purple);
        color: var(--dark-purple);
      }
      #dark-mode-toggle {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        background: var(--soft-purple);
        border: none;
        color: white;
        font-size: 1.2rem;
        padding: 0.35rem 0.5rem;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 8px rgb(107 70 193 / 0.5);
        transition: background-color 0.3s ease;
        z-index: 10000;
        width: 2rem;
        height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      @media (max-width: 480px) {
        body {
          padding: 0.5rem;
        }
        input[type="text"],
        select,
        button {
          font-size: 1rem;
        }
        #clear-today-btn {
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <h1>Michelle's To-Do List ðŸ’–</h1>
    <form id="todo-form">
      <input
        type="text"
        id="todo-input"
        placeholder="Add a new task..."
        autocomplete="off"
        required
      />
      <select id="task-type" aria-label="Task type">
        <option value="daily">Daily</option>
        <option value="today" selected>Today</option>
      </select>
      <button type="submit">Add</button>
    </form>

    <section id="daily-section" aria-label="Daily tasks section">
      <h2>Daily Tasks</h2>
      <ul id="daily-list"></ul>
    </section>

    <section id="today-section" aria-label="Today's tasks section">
      <h2>Today's Tasks</h2>
      <ul id="today-list"></ul>
      <button id="clear-today-btn" type="button">I did it!</button>
      <div id="error-message" role="alert"></div>
      <div id="confetti-container" aria-hidden="true"></div>
      <div id="encouragement-message" aria-live="polite"></div>
    </section>

    <!-- Dark mode toggle button -->
    <button
      id="dark-mode-toggle"
      aria-label="Toggle dark mode"
      title="Toggle dark mode"
    >
      ðŸŒ™
    </button>

    <!-- Include SortableJS from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <script>
      const form = document.getElementById("todo-form");
      const input = document.getElementById("todo-input");
      const taskTypeSelect = document.getElementById("task-type");
      const dailyListEl = document.getElementById("daily-list");
      const todayListEl = document.getElementById("today-list");
      const clearTodayBtn = document.getElementById("clear-today-btn");
      const errorMsgEl = document.getElementById("error-message");
      const confettiContainer = document.getElementById("confetti-container");
      const encouragementMsgEl = document.getElementById(
        "encouragement-message"
      );
      const darkModeToggle = document.getElementById("dark-mode-toggle");

      // Use localStorage keys
      const DAILY_KEY = "tasks_daily";
      const TODAY_KEY = "tasks_today";

      // Load Daily tasks
      let dailyTasks = JSON.parse(localStorage.getItem(DAILY_KEY) || "[]");

      // Load Today tasks
      let todayTasks = JSON.parse(localStorage.getItem(TODAY_KEY) || "[]");

      // Save functions
      function saveDailyTasks() {
        localStorage.setItem(DAILY_KEY, JSON.stringify(dailyTasks));
      }
      function saveTodayTasks() {
        localStorage.setItem(TODAY_KEY, JSON.stringify(todayTasks));
      }

      function renderTasks(listEl, tasks, isDaily) {
        listEl.innerHTML = "";
        tasks.forEach(({ id, text, completed }) => {
          const li = document.createElement("li");
          li.className = completed ? "completed" : "";
          li.dataset.id = id;

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = completed;
          checkbox.addEventListener("change", () => {
            const taskArray = isDaily ? dailyTasks : todayTasks;
            const task = taskArray.find((t) => t.id === id);
            if (task) {
              task.completed = checkbox.checked;
              if (isDaily) saveDailyTasks();
              else saveTodayTasks();
              hideErrorMsg();
              renderAll();
            }
          });

          const label = document.createElement("label");
          label.textContent = text;

          const delBtn = document.createElement("button");
          delBtn.textContent = "Ã—";
          delBtn.className = "delete-btn";
          delBtn.title = "Delete task";
          delBtn.addEventListener("click", () => {
            if (isDaily) {
              dailyTasks = dailyTasks.filter((t) => t.id !== id);
              saveDailyTasks();
            } else {
              todayTasks = todayTasks.filter((t) => t.id !== id);
              saveTodayTasks();
            }
            hideErrorMsg();
            renderAll();
          });

          // Drag handle element
          const dragHandle = document.createElement("span");
          dragHandle.className = "drag-handle";
          dragHandle.title = "Drag to reorder";
          dragHandle.textContent = "â‰¡";

          li.appendChild(checkbox);
          li.appendChild(label);
          li.appendChild(delBtn);
          li.appendChild(dragHandle);

          listEl.appendChild(li);
        });
      }

      // Drag and drop reorder logic with SortableJS
      function enableDragAndDrop() {
        // Destroy previous Sortable instances if any to avoid duplicates
        if (dailyListEl.sortableInstance)
          dailyListEl.sortableInstance.destroy();
        if (todayListEl.sortableInstance)
          todayListEl.sortableInstance.destroy();

        dailyListEl.sortableInstance = new Sortable(dailyListEl, {
          animation: 150,
          handle: ".drag-handle",
          scroll: true,
          scrollSensitivity: 60,
          scrollSpeed: 10,
          onEnd: () => {
            const newOrderIds = Array.from(dailyListEl.children).map(
              (li) => li.dataset.id
            );
            dailyTasks = newOrderIds.map((id) =>
              dailyTasks.find((t) => t.id === id)
            );
            saveDailyTasks();
            renderAll();
          },
        });

        todayListEl.sortableInstance = new Sortable(todayListEl, {
          animation: 150,
          handle: ".drag-handle",
          scroll: true,
          scrollSensitivity: 60,
          scrollSpeed: 10,
          onEnd: () => {
            const newOrderIds = Array.from(todayListEl.children).map(
              (li) => li.dataset.id
            );
            todayTasks = newOrderIds.map((id) =>
              todayTasks.find((t) => t.id === id)
            );
            saveTodayTasks();
            renderAll();
          },
        });
      }

      function renderAll() {
        renderTasks(dailyListEl, dailyTasks, true);
        renderTasks(todayListEl, todayTasks, false);
        enableDragAndDrop();
      }

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const text = input.value.trim();
        if (!text) return;

        const task = {
          id: Date.now().toString(),
          text,
          completed: false,
        };

        if (taskTypeSelect.value === "daily") {
          dailyTasks.push(task);
          saveDailyTasks();
        } else {
          todayTasks.push(task);
          saveTodayTasks();
        }

        hideErrorMsg();
        renderAll();
        input.value = "";
        input.focus();
      });

      function getRandomColor() {
        const hue = Math.floor(Math.random() * 360);
        return `hsl(${hue}, 70%, 70%)`;
      }

      function showRandomMultiConfetti() {
        const burstsCount = 30;

        const baseXRange = [window.innerWidth * 0.15, window.innerWidth * 0.85];
        const minY = window.innerHeight * 0.3;
        const maxY = window.innerHeight * 0.75;

        for (let b = 0; b < burstsCount; b++) {
          const x =
            baseXRange[0] + Math.random() * (baseXRange[1] - baseXRange[0]);
          const y = minY + Math.random() * (maxY - minY);

          const container = document.createElement("div");
          container.style.position = "fixed";
          container.style.left = `${x}px`;
          container.style.top = `${y}px`;
          container.style.width = "0px";
          container.style.height = "0px";
          container.style.pointerEvents = "none";
          container.style.overflow = "visible";
          container.style.zIndex = 9999;

          const piecesPerBurst = 15 + Math.floor(Math.random() * 16);

          for (let i = 0; i < piecesPerBurst; i++) {
            const piece = document.createElement("div");
            piece.classList.add("confetti");

            piece.style.backgroundColor = getRandomColor();

            const angle = Math.random() * 2 * Math.PI;
            const distance = 100 + Math.random() * 150;
            const xMove = Math.cos(angle) * distance + "px";
            const yMove = Math.sin(angle) * distance + "px";

            piece.style.setProperty("--x-move", xMove);
            piece.style.setProperty("--y-move", yMove);

            const duration = 1.3 + Math.random();
            piece.style.animation = `confetti-burst ${duration}s ease-out forwards`;

            const sizeX = 6 + Math.random() * 6;
            const sizeY = 4 + Math.random() * 4;
            piece.style.width = `${sizeX}px`;
            piece.style.height = `${sizeY}px`;

            container.appendChild(piece);
          }

          const delay = Math.random() * 1000;
          setTimeout(() => {
            document.body.appendChild(container);
            setTimeout(() => {
              container.remove();
            }, 2500);
          }, delay);
        }
      }

      clearTodayBtn.addEventListener("click", () => {
        const allDailyChecked = dailyTasks.every((t) => t.completed);
        const allTodayChecked = todayTasks.every((t) => t.completed);

        if (!allDailyChecked || !allTodayChecked) {
          showErrorMsg("Still more work to do! You got this");
          return;
        }

        todayTasks = [];
        saveTodayTasks();

        dailyTasks = dailyTasks.map((task) => ({ ...task, completed: false }));
        saveDailyTasks();

        hideErrorMsg();
        renderAll();

        showRandomMultiConfetti();

        encouragementMsgEl.textContent = "You did it!";
        encouragementMsgEl.style.display = "block";

        setTimeout(() => {
          encouragementMsgEl.style.display = "none";
        }, 4000);
      });

      function showErrorMsg(msg) {
        errorMsgEl.textContent = msg;
        errorMsgEl.style.display = "block";
      }
      function hideErrorMsg() {
        errorMsgEl.textContent = "";
        errorMsgEl.style.display = "none";
      }

      // DARK MODE TOGGLE LOGIC
      const savedDarkMode = localStorage.getItem("darkMode") === "true";

      function applyDarkMode(isDark) {
        if (isDark) {
          document.body.classList.add("dark-mode");
          darkModeToggle.textContent = "â˜€ï¸";
          darkModeToggle.title = "Switch to light mode";
        } else {
          document.body.classList.remove("dark-mode");
          darkModeToggle.textContent = "ðŸŒ™";
          darkModeToggle.title = "Switch to dark mode";
        }
      }

      applyDarkMode(savedDarkMode);

      darkModeToggle.addEventListener("click", () => {
        const isDark = document.body.classList.toggle("dark-mode");
        localStorage.setItem("darkMode", isDark);
        applyDarkMode(isDark);
      });

      renderAll();

      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("service-worker.js")
            .then(() => console.log("Service Worker registered"))
            .catch((err) =>
              console.error("Service Worker registration failed:", err)
            );
        });
      }
    </script>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyDwuelTrnNPJzo6ie76fq8wBnuo_6tqvNE",
        authDomain: "bean-to-do-push.firebaseapp.com",
        projectId: "bean-to-do-push",
        storageBucket: "bean-to-do-push.firebasestorage.app",
        messagingSenderId: "499713658484",
        appId: "1:499713658484:web:3d9b84b812315c92644b21",
        measurementId: "G-DGDZD13KX3",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
    </script>
  </body>
</html>
